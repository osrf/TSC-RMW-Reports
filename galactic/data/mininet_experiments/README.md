# Mininet Experiments

In this directory there is the raw data and an auto-generated report for the mininet experiments.

## Raw Data

The raw data is in the datetime folder [./2020-10-23_10-47-36](./2020-10-23_10-47-36).

It was produced using the `run_experiments.py` script in this repository on the `rmw_report` branch:

- [https://github.com/osrf/mininet_ros/blob/rmw_report/scripts/run_experiments.py](https://github.com/osrf/mininet_ros/blob/rmw_report/scripts/run_experiments.py)

This script does not take command-line arguments, but can be modified manually to control which settings are varied.

This dataset varied several settings like so:

```python
rmw_implementations = [
    ('rmw_fastrtps_cpp', 'async'),
    ('rmw_fastrtps_cpp', 'sync'),
    ('rmw_cyclonedds_cpp', 'sync'),
]
bandwidths = [
    54,  # 802.11g
    300,  # 802.11n
    1000,  # 1000BASE-T
]
losses = [0, 10, 20, 30, 40]
delays = [0]

rates = [30]
types = [
    'Array1k',
    'PointCloud512k',
]

for (rmw_implementation, async_pub) in rmw_implementations:
    for bandwidth in bandwidths:
        for loss in losses:
            for delay in delays:
                for rate in rates:
                    for topic_type in types:
                        do_it(
                            rmw_implementation=rmw_implementation,
                            bandwidth=bandwidth,
                            loss=loss,
                            delay=delay,
                            topic_type=topic_type,
                            rate=rate,
                            async_pub=async_pub,
                            repeat=10,
                        )
```

Each time `do_it()` is called the experiment is run with a different configuration and written into a folder, named for the various configurations.
Note that it repeats each experiment 10 times.

The results were collected in a virtual machine running Ubuntu 20.04 on a macOS host machine.
The virtual machine reports these system specifications (`lshw -short`):

- processor: Intel(R) Core(TM) i9-8950HK CPU @ 2.90GHz
- memory: 16GiB System memory

The macOS machine has the same stats except it has more memory (64GiB).

### Steps to Reproduce

To reproduce this data, follow these steps:

1. clone the repository to your linux machine, with docker installed
  - git clone https://github.com/osrf/mininet_ros -b rmw_report
1. change into the repostitory
  - cd mininet_ros
1. build the docker container
  - docker build . -t my_mininet_container
1. run the container in interactive mode, mapping this repository into the container
  - docker run -it --privileged -v `pwd`:/root/mininet_ros my_mininet_container
1. inside the docker container, create a directory to store the experiments and change to it
  - (docker) mkdir /root/mininet_ros/experiments
  - (docker) cd /root/mininet_ros/experiments
1. inside the docker container, run the experiments with the script
  - (docker) python3 /root/mininet_ros/scripts/run_experiments.py
  - This command will run the experiments one after another, repeating the experiments if necessary
    - rerunning the experiments is sometimes necessary as the experiments sometimes hang, which seems to be a bug in mininet
  - The results will be output in the current folder
1. exit the container and see that the experiments are in the folder you mapped into the container
  - (docker) exit
  - ls experiments

## Autogenerated Report

The autogenerated report is created using the `generate_multirun_report.py` script in this repository on the `rmw_report` branch:

- [https://github.com/osrf/mininet_ros/blob/rmw_report/scripts/run_experiments.py](https://github.com/osrf/mininet_ros/blob/rmw_report/scripts/run_experiments.py)

The script takes a few command-line arguments to point it to the root of the collected experiments:

```
% python3 ./scripts/generate_multirun_report.py -h
usage: generate_multirun_report.py [-h] [--log-dir LOG_DIR] [--output-dir OUTPUT_DIR]

optional arguments:
  -h, --help            show this help message and exit
  --log-dir LOG_DIR     Directory of the performance log data generated with run_experiments.py
  --output-dir OUTPUT_DIR
                        Directory to output the plots and report into
```

The script generates many plots as images and arranges them into lots of folders, and also generates a report in a few different formats, e.g. `.md` and `.html`.

To run the script you need these dependencies which you could get from `apt-get` or `pip`:

- python-markdown
- pandas
- matplotlib
- numpy
